##Process Monitor
##By ShowNadda

#Global Imports
import datetime
import psutil
from tabulate import tabulate

def get_processes():
    procs = []
    for p in psutil.process_iter():
        with p.oneshot():
            pid = p.pid
            if pid == 0:
                continue
            name = p.name()
            try:
                create_time = datetime.datetime.fromtimestamp(p.create_time())
            except OSError:
                create_time = datetime.datetime.fromtimestomp(psutil.boot_time())
            cpu_usage = p.cpu_percent()
            try:
                cpu_affinity = len(p.cpu.affinity())
            except psutil.AccessDenied:
                cpu_affinity = 0
            status = p.status()
            try:
                memory = p.memory_full_info().uss
            except psutil.AccessDenied:
                memory = 0
            try:
                user = p.username()
            except psutil.AccessDenied:
                user = "N/A"
            procs.append({
                "pid": pid,
                "name": name,
                "create_time": create_time,
                "cpu_usage": cpu_usage,
                "cpu_affinity": cpu_affinity,
                "status":status,
                "memory": memory,
                "user":user
            })
    return procs

def print_processes(ps):
    print(tabulate(ps, headers=ps[0].keys()))


print_processes(get_processes())